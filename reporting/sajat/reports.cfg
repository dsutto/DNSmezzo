[top100]
template = "top100.tmpl.xhtml"
output = "top100.html"
query = "SELECT DISTINCT registered_domain AS domain, count(registered_domain) AS count FROM DNS_packets WHERE query GROUP BY registered_domain ORDER BY count DESC LIMIT %(limit)s"
limit = 100
data = {'limit': limit}
keys = ('domain', 'count')
contexname = "domains"

[qtypes_png]
query = "select * from crosstab('select start, type, count from qtype order by 1,2') as qtype(start timestamp, A bigint, AAAA bigint, AXFR bigint, CNAME bigint, DLV bigint, DNSKEY bigint, MX bigint, NAPTR bigint, NS bigint, PTR bigint, PX bigint, SOA bigint, SPF bigint, SRV bigint, TXT bigint);"

[qtypes]
template = "qtypes.tmpl.xhtml"
output = "qtypes.html"
query = "SELECT type, meaning, count(*), cast(count(*) as real)/(select count(*) from dns_packets) as perc from dns_packets,dns_types where qtype=value group by 1, 2 order by 1 asc;"
keys = ('type', 'meaning', 'count', 'perc')
prep = (None, None, None, lambda n: '{0:.2%}.'.format(float(n)) )
contexname = "qtypes"

[nxdomain]
template = "nxdomain.tmpl.xhtml"
output = "nxdomain.html"
query = "SELECT DISTINCT registered_domain AS domain, count(registered_domain) AS num FROM DNS_packets WHERE NOT query AND rcode=3 GROUP BY registered_domain ORDER BY num DESC LIMIT %(limit)s"
limit = 100
data = {'limit': limit}
keys = ('domain', 'count', 'perc')
contexname = "domains"

[ipv6_png]
query = "select date_trunc('hour', date) + interval '1 minutes' * floor(extract(minute from date) / 1) as start, count(*) from dns_packets where query and family(src_address)=6 group by 1 order by 1 asc;"

[ipv6]
template = "ipv6.tmpl.xhtml"
output = "ipv6.html"
query = "select cast(count(*) as real) / (select count(*) from dns_packets where query) from dns_packets where query and family(src_address)=6 order by 1 asc;"
keys = ('perc',)
prep = (lambda n: '{0:.2%}.'.format(float(n)), )
contexname = "v6-queries"

